CREATE TABLE NHANVIEN (
    MANLD   VARCHAR2(10) PRIMARY KEY,
    HOTEN   VARCHAR2(100),
    PHAI    CHAR(5),
    NGSINH  DATE,
    LUONG   NUMBER(10,2),
    PHUCAP  NUMBER(10,2),
    DT      VARCHAR2(20),
    VAITRO  VARCHAR2(50),
    MADV    VARCHAR2(10)
);
CREATE TABLE SINHVIEN (
    MASV       VARCHAR2(10) PRIMARY KEY,
    HOTEN      VARCHAR2(100),
    PHAI       CHAR(5),
    NGSINH     DATE,
    DCHI       VARCHAR2(200),
    DT         VARCHAR2(20),
    KHOA       VARCHAR2(10),
    TINHTRANG  VARCHAR2(50) DEFAULT NULL
);
CREATE TABLE DONVI (
    MADV    VARCHAR2(10) PRIMARY KEY,
    TENDV   VARCHAR2(100),
    LOAIDV  VARCHAR2(20) CHECK (LOAIDV IN ('Khoa', 'Phòng')),
    TRGDV   VARCHAR2(10)
);
CREATE TABLE HOCPHAN (
    MAHP   VARCHAR2(10) PRIMARY KEY,
    TENHP  VARCHAR2(100),
    SOTC   NUMBER(2),
    STLT   NUMBER(3),
    STTH   NUMBER(3),
    MADV   VARCHAR2(10)
);
CREATE TABLE MOMON (
    MAMM   VARCHAR2(10) PRIMARY KEY,
    MAHP   VARCHAR2(10),
    MAGV   VARCHAR2(10),
    HK     NUMBER(1) CHECK (HK IN (1,2,3)),
    NAM    VARCHAR2(9),
    NGAYBD DATE
);
CREATE TABLE DANGKY (
    MASV     VARCHAR2(10),
    MAMM     VARCHAR2(10),
    DIEMTH   NUMBER(5,2),
    DIEMQT   NUMBER(5,2),
    DIEMCK   NUMBER(5,2),
    DIEMTK   NUMBER(5,2),
    PRIMARY KEY (MASV, MAMM)
);
--KHÓA NGOẠI
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NV_DV FOREIGN KEY (MADV) REFERENCES DONVI(MADV);
ALTER TABLE SINHVIEN ADD CONSTRAINT FK_SV_DV FOREIGN KEY (KHOA) REFERENCES DONVI(MADV);
ALTER TABLE DONVI ADD CONSTRAINT FK_DV_NV FOREIGN KEY (TRGDV) REFERENCES NHANVIEN(MANLD);
ALTER TABLE HOCPHAN ADD CONSTRAINT FK_HP_DV FOREIGN KEY (MADV) REFERENCES DONVI(MADV);
ALTER TABLE MOMON ADD CONSTRAINT FK_MM_HP FOREIGN KEY (MAHP) REFERENCES HOCPHAN(MAHP);
ALTER TABLE MOMON ADD CONSTRAINT FK_MM_NV FOREIGN KEY (MAGV) REFERENCES NHANVIEN(MANLD);
ALTER TABLE DANGKY ADD CONSTRAINT FK_DK_SV FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV);
ALTER TABLE DANGKY ADD CONSTRAINT FK_DK_MM FOREIGN KEY (MAMM) REFERENCES MOMON(MAMM);
-- data
-- Chèn dữ liệu cho bảng DONVI (với TRGDV là NULL ban đầu)
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV) VALUES ('CNTT', 'Khoa Công nghệ Thông tin', 'Khoa', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV) VALUES ('VL', 'Khoa Vật Lý', 'Khoa', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV) VALUES ('HH', 'Khoa Hóa học', 'Khoa', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV) VALUES ('KT', 'Khoa Kinh tế', 'Khoa', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV) VALUES ('PĐT', 'Phòng Đào tạo', 'Phòng', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV) VALUES ('PKT', 'Phòng Khảo thí', 'Phòng', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV) VALUES ('PTCHC', 'Phòng Tổ chức Hành chính', 'Phòng', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV) VALUES ('PCTSV', 'Phòng Công tác Sinh viên', 'Phòng', NULL);

-- Chèn dữ liệu cho bảng NHANVIEN
-- Trưởng đơn vị (sẽ được dùng để cập nhật DONVI.TRGDV)
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('TDV001', 'Nguyễn Văn An', 'Nam', TO_DATE('1970-05-10', 'YYYY-MM-DD'), 30000000, 5000000, '0901234567', 'TRGĐV', 'CNTT');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('TDV002', 'Trần Thị Bình', 'Nữ', TO_DATE('1975-08-15', 'YYYY-MM-DD'), 28000000, 4500000, '0902345678', 'TRGĐV', 'VL');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('TDV003', 'Lê Văn Cường', 'Nam', TO_DATE('1980-11-20', 'YYYY-MM-DD'), 25000000, 4000000, '0903456789', 'TRGĐV', 'PĐT');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('TDV004', 'Phạm Thị Dung', 'Nữ', TO_DATE('1978-03-25', 'YYYY-MM-DD'), 26000000, 4200000, '0904567890', 'TRGĐV', 'HH');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('TDV005', 'Hoàng Văn Em', 'Nam', TO_DATE('1972-07-30', 'YYYY-MM-DD'), 27000000, 4300000, '0905678901', 'TRGĐV', 'PKT');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('TDV006', 'Trịnh Văn Quý', 'Nam', TO_DATE('1976-02-14', 'YYYY-MM-DD'), 25000000, 4100000, '0906789012', 'TRGĐV', 'PTCHC');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('TDV007', 'Đặng Thị Sen', 'Nữ', TO_DATE('1979-09-09', 'YYYY-MM-DD'), 24000000, 3900000, '0907890123', 'TRGĐV', 'PCTSV');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('TDV008', 'Vương Tuấn Tú', 'Nam', TO_DATE('1973-10-10', 'YYYY-MM-DD'), 27500000, 4350000, '0908901234', 'TRGĐV', 'KT');

-- Giảng viên
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('GV001', 'Vũ Minh Hải', 'Nam', TO_DATE('1985-02-10', 'YYYY-MM-DD'), 15000000, 1500000, '0911234501', 'GV', 'CNTT');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('GV002', 'Đỗ Thị Lan', 'Nữ', TO_DATE('1988-06-22', 'YYYY-MM-DD'), 14000000, 1200000, '0912345002', 'GV', 'CNTT');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('GV003', 'Nguyễn Thị Kiều', 'Nữ', TO_DATE('1990-09-30', 'YYYY-MM-DD'), 16000000, 1800000, '0913450003', 'GV', 'VL');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('GV004', 'Trần Văn Long', 'Nam', TO_DATE('1982-12-05', 'YYYY-MM-DD'), 17000000, 2000000, '0914500004', 'GV', 'HH');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('GV005', 'Lê Thị Mai', 'Nữ', TO_DATE('1986-07-18', 'YYYY-MM-DD'), 15500000, 1600000, '0915600005', 'GV', 'KT');

-- Nhân viên Phòng Đào tạo
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('NVPDT001', 'Phan Văn Giang', 'Nam', TO_DATE('1992-01-15', 'YYYY-MM-DD'), 10000000, 1000000, '0921234501', 'NV PĐT', 'PĐT');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('NVPDT002', 'Hà Thị Kim', 'Nữ', TO_DATE('1995-03-28', 'YYYY-MM-DD'), 9000000, 800000, '0922345002', 'NV PĐT', 'PĐT');

-- Nhân viên Phòng Khảo thí
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('NVPKT001', 'Lý Văn Hùng', 'Nam', TO_DATE('1993-07-07', 'YYYY-MM-DD'), 9500000, 900000, '0931234501', 'NV PKT', 'PKT');

-- Nhân viên Phòng Tổ chức hành chính
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('NVTCHC001', 'Mai Thị Thu', 'Nữ', TO_DATE('1990-10-10', 'YYYY-MM-DD'), 10500000, 1100000, '0941234501', 'NV TCHC', 'PTCHC');

-- Nhân viên Phòng Công tác sinh viên
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('NVCTSV001', 'Ngô Văn Nam', 'Nam', TO_DATE('1994-04-04', 'YYYY-MM-DD'), 9200000, 850000, '0951234501', 'NV CTSV', 'PCTSV');

-- Nhân viên cơ bản
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('NVCB001', 'Bùi Văn Sang', 'Nam', TO_DATE('1989-08-08', 'YYYY-MM-DD'), 8000000, 500000, '0961234501', 'NVCB', 'CNTT');
INSERT INTO NHANVIEN (MANLD, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV) VALUES ('NVCB002', 'Cao Thị Tâm', 'Nữ', TO_DATE('1991-11-11', 'YYYY-MM-DD'), 7500000, 400000, '0962345002', 'NVCB', 'PĐT');

-- Cập nhật TRGDV cho bảng DONVI (sau khi đã chèn các nhân viên TRGĐV)
UPDATE DONVI SET TRGDV = 'TDV001' WHERE MADV = 'CNTT';
UPDATE DONVI SET TRGDV = 'TDV002' WHERE MADV = 'VL';
UPDATE DONVI SET TRGDV = 'TDV004' WHERE MADV = 'HH';
UPDATE DONVI SET TRGDV = 'TDV008' WHERE MADV = 'KT';
UPDATE DONVI SET TRGDV = 'TDV003' WHERE MADV = 'PĐT';
UPDATE DONVI SET TRGDV = 'TDV005' WHERE MADV = 'PKT';
UPDATE DONVI SET TRGDV = 'TDV006' WHERE MADV = 'PTCHC';
UPDATE DONVI SET TRGDV = 'TDV007' WHERE MADV = 'PCTSV';

-- Chèn dữ liệu cho bảng SINHVIEN
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG) VALUES ('SV0001', 'Trần Ngọc Anh', 'Nữ', TO_DATE('2003-08-20', 'YYYY-MM-DD'), '123 Nguyễn Trãi, Q1, TPHCM', '0987654321', 'CNTT', 'Đang học');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG) VALUES ('SV0002', 'Lê Hoàng Bảo', 'Nam', TO_DATE('2002-10-10', 'YYYY-MM-DD'), '456 Lê Lợi, Q3, TPHCM', '0987123456', 'CNTT', 'Đang học');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG) VALUES ('SV0003', 'Phạm Thị Chi', 'Nữ', TO_DATE('2003-01-15', 'YYYY-MM-DD'), '789 Cách Mạng Tháng Tám, Q10, TPHCM', '0912345678', 'VL', 'Đang học');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG) VALUES ('SV0004', 'Nguyễn Văn Duy', 'Nam', TO_DATE('2001-12-05', 'YYYY-MM-DD'), '321 Võ Văn Tần, Q3, TPHCM', '0909876543', 'HH', 'Nghỉ học');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG) VALUES ('SV0005', 'Hoàng Thị Yến', 'Nữ', TO_DATE('2004-02-28', 'YYYY-MM-DD'), '111 Điện Biên Phủ, Bình Thạnh, TPHCM', '0977123789', 'KT', 'Đang học');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG) VALUES ('SV0006', 'Võ Minh Khang', 'Nam', TO_DATE('2003-07-19', 'YYYY-MM-DD'), '222 Pasteur, Q1, TPHCM', '0966554433', 'CNTT', 'Bảo lưu');

-- Chèn dữ liệu cho bảng HOCPHAN
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV) VALUES ('HP001', 'Lập trình Căn bản', 4, 45, 30, 'CNTT');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV) VALUES ('HP002', 'Cấu trúc Dữ liệu', 4, 45, 30, 'CNTT');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV) VALUES ('HP003', 'Vật lý Đại cương A1', 3, 30, 15, 'VL');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV) VALUES ('HP004', 'Hóa học Vô cơ', 3, 30, 15, 'HH');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV) VALUES ('HP005', 'Kinh tế Vi mô', 3, 45, 0, 'KT');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV) VALUES ('HP006', 'Giải tích 1', 4, 60, 0, 'CNTT'); -- Giả sử khoa CNTT phụ trách môn này

-- Chèn dữ liệu cho bảng MOMON
-- Năm học 2023
-- Năm học 2023
INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM001', 'HP001', 'GV001', 1, '2023-2024', TO_DATE('2023-09-01', 'YYYY-MM-DD'));
INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM002', 'HP003', 'GV003', 1, '2023-2024', TO_DATE('2023-09-01', 'YYYY-MM-DD'));

INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM003', 'HP005', 'GV005', 1, '2023-2024', TO_DATE('2023-09-01', 'YYYY-MM-DD'));

INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM004', 'HP002', 'GV002', 2, '2023-2024', TO_DATE('2024-01-15', 'YYYY-MM-DD'));

INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM005', 'HP004', 'GV004', 2, '2023-2024', TO_DATE('2024-01-15', 'YYYY-MM-DD'));

INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM006', 'HP006', 'GV001', 2, '2023-2024', TO_DATE('2024-01-15', 'YYYY-MM-DD'));

-- Năm học 2024
INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM007', 'HP001', 'GV001', 1, '2024-2025', TO_DATE('2024-09-01', 'YYYY-MM-DD'));

INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM008', 'HP002', 'GV002', 1, '2024-2025', TO_DATE('2024-09-01', 'YYYY-MM-DD'));

INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM, NGAYBD) 
VALUES ('MM009', 'HP002', 'GV002', 2, '2024-2025', TO_DATE('2025-01-15', 'YYYY-MM-DD'));

-- Chèn dữ liệu cho bảng DANGKY
-- SV0001
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV0001', 'MM001', 8.5, 7.5, 8.0, 8.0); 
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV0001', 'MM004', 9.0, 8.0, 8.5, 8.5); 
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV0001', 'MM007', NULL, NULL, NULL, NULL); 

-- SV0002
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV0002', 'MM001', 7.0, 6.5, 7.5, 7.1); 
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV0002', 'MM006', NULL, 7.0, 6.0, 6.4); 

-- SV0003
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV0003', 'MM002', 8.0, 7.0, 7.5, 7.5); 

-- SV0005
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV0005', 'MM003', NULL, 8.5, 9.0, 8.8);
--drop table dangky;
--drop table momon ;
--drop table hocphan;
--drop table sinhvien;
--alter table nhanvien drop constraint FK_NV_DV;
--drop table donvi;
--drop table nhanvien;
